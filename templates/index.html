<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sokoban Webpage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header>
        <h2 class ="logo">Sokoban</h2>
        <nav class="navigation">
            {% if current_user.is_authenticated %}
                <span class="welcome-msg">Welcome, {{ current_user.username }}!</span>
            {% endif %}
            <a href="#">Explanation</a>
            <a href="#" id="leaderboardLink">LeaderBoard</a>
            <!-- button id="loginbtn" class="login-popup">Login</button -->
             <button id="loginbtn" class="login-popup">
                {{ 'Logout' if current_user.is_authenticated else 'Login' }}
            </button>
        </nav>
    </header>

    <nav class="sidebar">
        <a href="#" id="openLevelsPanel">Levels</a>
        <a href="#" id="gameEngineLink">Game Engine Test</a>
        <a href="#">Custom</a>
    </nav>

    <div id="levelsPanel" class="sidepanel">
        <a href="javascript:void(0)" class="closebtn" id="closeLevelsPanel">&times;</a>
        <div class="submenu-buttons">
            <button>1</button>
            <button>2</button>
            <button>3</button>
            <button>4</button>
        </div>
    </div>

    <!-- Make sure that the src has a layout corresponding to its status as an iframe page-->
    <iframe id="mainFrame" src="{{ url_for('dashboard') if current_user.is_authenticated else '' }}" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
       
    <script>
    // Script for the login popup
    const iframe = document.getElementsByTagName('iframe')[0];
    const loginBtn = document.getElementById('loginbtn');
    const isLoggedIn = {{ current_user.is_authenticated | lower }};
    let loginPageVisible = false;

    loginBtn.onclick = function() {
        if (isLoggedIn) {
            window.top.location.href = '/logout';
        } else {
        // Not logged in â†’ toggle login page in iframe
        // Note this might not work perfectly, needs to be tested
            if (!loginPageVisible) {
                iframe.src = '/login';
                loginPageVisible = true;
            } else {
                iframe.src = ''; // Clear iframe
                loginPageVisible = false;
            }
        }
    };

    // Script for the level selection
    document.getElementById('openLevelsPanel').onclick = function(e) {
        e.preventDefault();
        document.getElementById('levelsPanel').classList.add('open');
    };
    document.getElementById('closeLevelsPanel').onclick = function() {
        document.getElementById('levelsPanel').classList.remove('open');
    };

    // Script for the leaderboard link
    document.getElementById('leaderboardLink').onclick = function(e) {
        e.preventDefault();
        document.getElementById('mainFrame').src = '/leaderboard';
        loginPageVisible = false;
    };

    // Script for the level buttons in the side panel
    const levelButtons = document.querySelectorAll('.submenu-buttons button');
    levelButtons.forEach(button => {
        button.addEventListener('click', () => {
            const levelId = button.textContent.trim(); // e.g. "1", "2", etc.
            document.getElementById('mainFrame').src = `/play/${levelId}`;
            loginPageVisible = false;
        });
    });

    // Script for the game engine link
    document.getElementById('gameEngineLink').onclick = function(e) {
        e.preventDefault();
        document.getElementById('mainFrame').src = '/game_engine';
        loginPageVisible = false;
    };
    </script>

</body>
</html>